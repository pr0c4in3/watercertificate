# 数据库管理类

## `login_db` 类

`login_db` 类负责管理与用户登录相关的数据库操作。它包括以下方法：

### 方法

#### `__init__(self, db_name: str = 'login.db')`
初始化 `login_db` 类并连接到 SQLite 数据库。如果数据库不存在，则会创建一个新的数据库文件。

#### `create_table(self)`
创建 `users` 表以存储用户信息，包括用户名和密码。如果表已存在，则不会重复创建。

#### `register_user(self, username: str, password: str) -> bool`
将新用户注册到 `users` 表中。如果用户名已存在，返回 `False`；否则，返回 `True`。

#### `authenticate_user(self, username: str, password: str) -> bool`
验证用户名和密码是否匹配。如果匹配，返回 `True`；否则，返回 `False`。

## `ca_db` 类

`ca_db` 类负责管理与证书相关的数据库操作。它包括以下方法：

### 方法

#### `__init__(self, db_name: str = 'ca.db')`
初始化 `ca_db` 类并连接到 SQLite 数据库。如果数据库不存在，则会创建一个新的数据库文件。

#### `create_table(self)`
创建 `certificates` 表以存储证书信息，包括用户名、图片路径、图片名、数字水印内容和数字水印密钥。如果表已存在，则不会重复创建。

#### `add_certificate(self, username: str, image_path: str, image_name: str, watermark: str, watermark_key: str)`
将新的证书添加到 `certificates` 表中。

#### `get_certificate(self, image_name: str) -> Optional[dict]`
根据图片名从 `certificates` 表中检索证书信息。如果找到，返回包含证书信息的字典；否则，返回 `None`。

## 示例使用

以下是如何使用 `login_db` 和 `ca_db` 类的示例：

```python
if __name__ == "__main__":
    login_manager = login_db()
    ca_manager = ca_db()

    # Register a new user
    if login_manager.register_user('user1', 'password123'):
        print('User registered successfully.')
    else:
        print('Username already exists.')

    # Authenticate user
    if login_manager.authenticate_user('user1', 'password123'):
        print('Authentication successful.')
    else:
        print('Authentication failed.')

    # Add a new certificate
    ca_manager.add_certificate('user1', '/path/to/image', 'image1.png', 'watermark_data', 'watermark_key123')

    # Retrieve a certificate
    cert = ca_manager.get_certificate('image1.png')
    if cert:
        print(f'Certificate found: {cert}')
    else:
        print('Certificate not found.')
